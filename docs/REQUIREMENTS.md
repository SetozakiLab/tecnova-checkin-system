# tec-nova 入退場管理システム 要件定義書

**最終更新日:** 2025-07-03

---

## 1. プロジェクト概要

### 1.1. システム名

- tec-nova 入退場管理システム

### 1.2. コンセプト

- **目的**: 小学生から高校生が利用する施設「tec-nova」において、ゲスト（子供）の入退場プロセスをデジタル化し、施設管理者（メンター）の運営負担を軽減する。
- **コア機能**: ゲスト自身による簡単なチェックイン/アウト操作と、メンターによるリアルタイムでの滞在状況の把握。

### 1.3. 開発背景とゴール

- **課題**:
  - 従来のアナログな受付業務（紙への記入や案内など）がメンターの負担になっている。
  - リアルタイムでの滞在者把握が難しく、活動ログ作成に手間がかかる。
  - 情報が紙媒体で管理されており、データの活用や保管が非効率。
- **ゴール**:
  - **メンターの負担軽減**: 受付業務を自動化し、本来のサポート業務に集中できる環境を整える。
  - **運営の効率化**: 情報をデジタル化し、リアルタイムでの滞在者監視とデータ集計を容易にする。
  - **将来への拡張性**: ゲスト情報を ID で一元管理し、将来的な活動ログシステムやその他機能との連携基盤を構築する。

### 1.4. ターゲットユーザー

- **ゲスト（子供）**:
  - 役割: 施設の利用者。
  - 利用シーン: 来場時の新規登録、入退場の手続き。
- **管理者（メンター）**:
  - 役割: 施設の運営・管理者。
  - 利用シーン: リアルタイムでの滞在者状況確認、入退場履歴の集計、ゲスト情報の管理。

---

## 2. 機能要件

### 2.1. 機能一覧 (MVP: Minimum Viable Product)

#### ゲスト向け機能（受付端末）

- **新規ゲスト登録機能**:
  - 氏名（ニックネーム可）、メールアドレス（任意）などの基本情報を登録する。
  - 登録時にシステムでユニークな ID を自動的に発行する。
- **利用規約同意機能**:
  - 新規登録フローの中で、施設の利用規約を表示し、同意チェックを必須とする。
- **入退場（チェックイン/アウト）機能**:
  - 発行された ID や氏名で自身を検索する。
  - 画面のボタンをタップするだけの簡単な操作で入退場を記録する。
  - チェックイン時に歓迎メッセージ、チェックアウト時に見送りメッセージを表示する。

#### 管理者向け機能（管理画面）

- **セキュアなログイン機能**:
  - ID/パスワード認証により、権限のないアクセスを防ぐ。
- **ダッシュボード（リアルタイム滞在者一覧）**:
  - 現在施設内にいるゲストの氏名、入室時刻を一覧表示する。
  - 現在の滞在人数をリアルタイムで表示する。
  - 一覧は定期的に自動更新される。
- **入退場履歴の管理機能**:
  - 過去の入退場記録を日付やゲスト名で検索・閲覧できる。
  - 必要に応じて、手動での記録修正や追加が可能。
- **ゲスト情報管理（CRUD）機能**:
  - 登録されているゲスト情報（氏名など）の参照、編集、削除ができる。

### 2.2. 将来的な拡張機能

- **活動ログシステムとの連携**: 誰が・いつ・何をしたかを記録する別システムと連携する。
- **QR コードによる入退場**: 各ゲストにユニークな QR コードを発行し、リーダーで読み取るだけでチェックイン/アウトを完結させる。
- **統計データのエクスポート**: 入退場履歴や滞在時間などのデータを CSV 形式でダウンロードできるようにする。
- **保護者への通知**: ゲストの入退場時に、登録された保護者のメールアドレスへ自動通知する。

### 2.3. 画面フロー

- **ゲスト向け画面**

  1. **トップ画面**: 「はじめての方（新規登録）」「メンバーの方（入退場）」を選択。
  2. **利用規約画面**: (新規登録時) 規約を表示し同意を求める。
  3. **新規登録画面**: 情報を入力する。
  4. **登録完了画面**: 発行された ID などを表示し、入退場画面へ誘導する。
  5. **入退場画面**: ゲストを検索し、「チェックイン」「チェックアウト」ボタンを表示。
  6. **完了画面**: 操作完了メッセージ（「ようこそ！」「またね！」など）を表示。

- **管理者向け画面**

  1. **ログイン画面**: ID とパスワードを入力。
  2. **ダッシュボード**: メイン画面。リアルタイム滞在者一覧を表示。
  3. **入退場履歴画面**: 履歴の検索と一覧表示。
  4. **ゲスト管理画面**: ゲスト情報の一覧と編集・削除機能。

- **画面遷移図**

  ```mermaid
  graph TD
      subgraph ゲストフロー
          A[トップ] -->|はじめての方| B(利用規約);
          A -->|メンバーの方| E[入退場画面];
          B --> C[新規登録];
          C --> D[登録完了];
          D --> E;
          E --> F[完了画面];
          F --> A;
      end

      subgraph 管理者フロー
          G[ログイン] --> H[ダッシュボード];
          H --> I[入退場履歴];
          H --> J[ゲスト管理];
          I --> H;
          J --> H;
      end
  ```

### 2.4. データモデル（データベース設計）

- ER 図や詳細なリレーションは別途設計するが、主要なテーブル構成は以下を想定する。

- **`Guest` (ゲスト)**

  - `id`: UUID (主キー, QR コード用)
  - `displayId`: Int (表示用 ID, 自動採番)
  - `name`: String (氏名)
  - `contact`: String? (メールアドレス, オプショナル)
  - `createdAt`: DateTime (登録日時)
  - `updatedAt`: DateTime (更新日時)

- **`CheckinRecord` (入退場記録)**

  - `id`: UUID (主キー)
  - `guestId`: UUID (Guest テーブルへの外部キー)
  - `checkinAt`: DateTime (チェックイン時刻)
  - `checkoutAt`: DateTime? (チェックアウト時刻, 滞在中の場合は NULL)
  - `isActive`: Boolean (現在滞在中かどうか)

- **`User` (管理者)**
  - `id`: UUID (主キー)
  - `username`: String (ログイン ID, ユニーク)
  - `hashedPassword`: String (ハッシュ化されたパスワード)
  - `createdAt`: DateTime
  - `updatedAt`: DateTime

---

## 3. 非機能要件

- **対応環境**:
  - **ゲスト受付端末**: 最新版の Chrome/Safari/Edge が動作するタブレットまたは PC。
  - **管理者端末**: 最新版の Chrome/Safari/Edge が動作する PC またはタブレット。
- **パフォーマンス**:
  - **応答速度**: ゲストの入退場処理は 2 秒以内に完了すること。
  - **データ更新**: 管理者ダッシュボードの滞在者一覧は 5 秒間隔で自動更新すること。
- **セキュリティ**:
  - **認証**: 管理者機能は全てログインが必須。NextAuth.js 等を利用し、セキュアなセッション管理を行う。
  - **パスワード管理**: パスワードは `bcrypt` 等のアルゴリズムでハッシュ化して保存する。
  - **脆弱性対策**: ORM(Prisma)を利用した SQL インジェクション対策、Next.js の機能を利用した XSS 対策を講じる。
- **UI/UX**:
  - **ゲスト向け画面**: 子供が直感的に操作できるよう、ひらがなを多用し、大きなボタンとイラスト/アイコンを配置する。テキスト入力は最小限に抑える。
  - **管理者向け画面**: 必要な情報（誰がいるか、何人いるか）が一目でわかる、視認性の高いダッシュボードデザインを採用する。

---

## 4. 開発・運用計画

- **開発スコープ**:
  - 第一次リリースとして **2.1. 機能一覧 (MVP)** に記載された機能の実装を最優先とする。
- **技術スタック**:
  - **言語**: TypeScript
  - **フレームワーク**: Next.js (App Router)
  - **UI**: Shadcn/UI, Tailwind CSS
  - **ORM**: Prisma
  - **データベース**: PostgreSQL
  - **認証**: NextAuth.js
  - **インフラ**: 自前サーバー (Linux/Docker)
  - **コード管理**: GitHub

---

## 5. その他・メモ

- ゲストの `displayId` (表示用 ID) は、子供たちが覚えやすいように短い整数にする。
  - 例えば、年と連番を組み合わせた形式`YYXXX`（例: `25001`, `25002`）など。
  - YY: 年（2025 → 25）
  - XXX: 年内の連番（001 から 999 まで）
- ゲストの氏名は、ニックネームや本名のどちらでも登録可能とする。
- ゲストのメールアドレスは任意入力とし、保護者への通知機能は将来的な拡張として検討する。
